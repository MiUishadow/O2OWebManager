package com.o2oweb.action;

import java.io.ByteArrayInputStream;

import net.sf.json.JSONObject;

import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Service;

import com.o2oweb.util.BaseAction;
import com.o2oweb.util.ValidateCodeUtil;
import com.opensymphony.xwork2.ActionContext;
import com.opensymphony.xwork2.ActionSupport;

@Scope("request")
@Service("validCodeAction")
public class ValidCodeAction extends BaseAction {
	
	private ByteArrayInputStream imageStream;
	
	
	public ByteArrayInputStream getImageStream() {
		return imageStream;
	}


	public void setImageStream(ByteArrayInputStream imageStream) {
		this.imageStream = imageStream;
	}


	@Override
	public String execute() throws Exception {
		String validCode = ValidateCodeUtil.getValidateCode();
		System.out.println("ValidCode : "+ validCode);
		imageStream = ValidateCodeUtil.getImageAsStream(validCode);
		ActionContext.getContext().getSession().put("validCode", validCode);
		return SUCCESS;
	}
	public String getCode() {
		String code = (String) ActionContext.getContext().getSession().get("validCode");
		JSONObject obj = new JSONObject();
		obj.accumulate("code", code);
		writeResponse(obj);
		return "Code";
	}
}
